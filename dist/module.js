"use strict";angular.module("sendSms",["ngMaterial","primo-explore.components"]),angular.module("sendSms").component("addSmsAction",{require:{prmActionCtrl:"^prmActionList"},controller:["customActions","smsOptions",function(e,n){var t=this;this.$onInit=function(){e.actionExists(n.smsAction,t.prmActionCtrl)||e.addAction(n.smsAction,t.prmActionCtrl)},this.$onDestroy=function(){e.actionExists(n.smsAction,t.prmActionCtrl)&&e.removeAction(n.smsAction,t.prmActionCtrl)}}]}),angular.module("sendSms").factory("customActions",function(){return{addAction:function(e,n){this.actionExists(e,n)?console.error("Action already exists: ",e):(this.addActionIcon(e,n),n.actionListService.requiredActionsList.splice(e.index,0,e.name),n.actionListService.actionsToIndex[e.name]=e.index,n.actionListService.onToggle[e.name]=e.onToggle,n.actionListService.actionsToDisplay.unshift(e.name))},removeAction:function(e,n){if(this.actionExists(e,n)){this.removeActionIcon(e,n),delete n.actionListService.actionsToIndex[e.name],delete n.actionListService.onToggle[e.name];var t=n.actionListService.actionsToDisplay.indexOf(e.name);n.actionListService.actionsToDisplay.splice(t,1),t=n.actionListService.requiredActionsList.indexOf(e.name),n.actionListService.requiredActionsList.splice(t,1)}else console.error("Action does not exist: ",e)},addActionIcon:function(e,n){n.actionLabelNamesMap[e.name]=e.label,n.actionIconNamesMap[e.name]=e.name,n.actionIcons[e.name]=e.icon},removeActionIcon:function(e,n){delete n.actionLabelNamesMap[e.name],delete n.actionIconNamesMap[e.name],delete n.actionIcons[e.name]},actionExists:function(e,n){return n.actionListService.actionsToIndex.hasOwnProperty(e.name)}}}),angular.module("sendSms").component("ocaSendSms",{bindings:{item:"<",finishedSmsEvent:"&"},template:'\n  <div class="send-actions-content-item" layout="row">\n      <md-content layout-wrap layout-padding layout-fill>\n          <form name="smsForm" novalidate layout="column" layout-align="center center" (submit)="$ctrl.sendSms($event);">\n              <div layout="row" class="layout-full-width" layout-align="center center">\n                  <div flex="20" flex-sm="10" hide-xs></div>\n                  <div class="form-focus service-form" layout-padding flex>\n                      <div layout-margin>\n                          <div layout="column">\n                              <h4 class="md-subhead">Standard message and data rates may apply.</h4>\n                              <md-input-container class="underlined-input md-required"><label>Phone number:</label>\n                                  <input ng-model="$ctrl.phoneNumber" name="phoneNumber" type="text" required ng-pattern="::$ctrl.telRegEx">\n                                  <div ng-messages="smsForm.phoneNumber.$error">\n                                      <div ng-message="pattern, required ">phone number is invalid</div>\n                                  </div>\n                              </md-input-container>\n                              <md-input-container class="md-required"><label>Carrier:</label>\n                                <md-select ng-model="$ctrl.carrier" name="carrier" placeholder="Select a carrier" required>\n                                  <md-option ng-repeat="(carrier, address) in carriers" value="{{ address }}">\n                                    {{ carrier }}\n                                  </md-option>\n                                </md-select>\n                                <div ng-messages="smsForm.carrier.$error">\n                                    <div ng-message="required">please select a carrier</div>\n                                </div>\n                              </md-input-container>\n                              <md-input-container class="underlined-input" ng-if="$ctrl.isCaptcha">\n                                  <div vc-recaptcha key="$ctrl.getCaptchaPublicKey()" on-success="$ctrl.setResponse(response)"></div>\n                                  <span class="recaptcha-error-info" ng-show="smsForm.$submitted && (smsForm.recaptchaResponse.$invalid || smsForm.$error.recaptcha.length)">\n                                    <span translate="captcha.notselected"></span>\n                                  </span>\n                              </md-input-container>\n                          </div>\n                      </div>\n                  </div>\n                  <div flex="20" flex-sm="10" hide-xs></div>\n              </div>\n              <div layout="row">\n                  <div layout="row" layout-align="center" layout-fill>\n                      <md-button type="submit" class="button-with-icon button-large button-confirm" aria-label="Send the result by SMS">\n                          <prm-icon icon-type="svg" svg-icon-set="primo-ui" icon-definition="send"></prm-icon><span translate="email.popup.link.send"></span></md-button>\n                  </div>\n              </div>\n          </form>\n      </md-content>\n  </div>\n  <prm-send-email ng-hide="true"></prm-send-email>\n  <oca-send-sms-after parent-ctrl="$ctrl"></oca-send-sms-after>',controller:["$scope","smsOptions",function(e,n){var t=this;this.$onInit=function(){e.$watch("$$childTail.$ctrl",function(e){return t.sendEmailService=e.sendEmailService}),e.carriers=n.smsCarriers,t.carrier=t.phoneNumber="",t.telRegEx=/^\d{3}( |-)?\d{3}( |-)?\d{4}$/},this.validate=function(){return t.telRegEx.test(t.phoneNumber)&&t.carrier},this.isCaptcha=function(){return"Y"==window.appConfig["system-configuration"]["Activate Captcha [Y/N]"]},this.getCaptchaPublicKey=function(){return window.appConfig["system-configuration"]["Public Captcha Key"]},this.setResponse=function(e){return t.gCaptchaResponse=e},this.sendSms=function(){t.validate()&&t.sendEmailService.sendEmail([t.phoneNumber+"@"+t.carrier],"","",[t.item],t.gCaptchaResponse).then(function(e){return console.log("sms successfully sent",e)}).catch(function(e){return console.error("sms sending failed",e)}).finally(function(){return t.finishedSmsEvent()})}}]}).run(["$templateCache","smsOptions",function(e,n){e.put("components/search/actions/actionContainer/action-container.html","\n  <oca-send-sms ng-if=\"($ctrl.actionName==='"+n.smsAction.name+'\')" finished-sms-event="$ctrl.throwCloseTabsEvent()" item="::$ctrl.item"></oca-send-sms>\n  <prm-send-email ng-if="($ctrl.actionName===\'E-mail\')" (finished-email-event)="$ctrl.throwCloseTabsEvent()" [item]="::$ctrl.item" [toggleform]="::$ctrl.toggleActionCotent" [user]="::\'\'"></prm-send-email>\n  <prm-citation ng-if="($ctrl.actionName===\'Citation\')" [item]="::$ctrl.item" [on-toggle]="::$ctrl.onToggle"></prm-citation>\n  <prm-permalink ng-if="($ctrl.actionName===\'Permalink\')" [item]="::$ctrl.item" [on-toggle]="::$ctrl.onToggle"></prm-permalink>\n  <prm-print-item ng-if="($ctrl.actionName===\'Print\')" (close-tabs-event)="$ctrl.throwCloseTabsEvent()" [item]="::$ctrl.item" [on-toggle]="::$ctrl.onToggle"></prm-print-item>\n  <prm-endnote ng-if="($ctrl.actionName===\'EndNote\')" (close-tabs-event)="$ctrl.throwCloseTabsEvent()" [item]="::$ctrl.item" [on-toggle]="::$ctrl.onToggle"></prm-endnote>\n  <prm-easybib ng-if="($ctrl.actionName===\'EasyBib\')" (close-tabs-event)="$ctrl.throwCloseTabsEvent()" [item]="::$ctrl.item" [on-toggle]="::$ctrl.onToggle"></prm-easybib>\n  <prm-refworks ng-if="($ctrl.actionName===\'RefWorks\')" (close-tabs-event)="$ctrl.throwCloseTabsEvent()" [item]="::$ctrl.item" [on-toggle]="::$ctrl.onToggle"></prm-refworks>\n  <prm-export-ris ng-if="($ctrl.actionName===\'RISPushTo\')" [item]="::$ctrl.item" [on-toggle]="::$ctrl.onToggle"></prm-export-ris>\n  <prm-action-container-after parent-ctrl="$ctrl"></prm-action-container-after>')}]),angular.module("sendSms").value("smsOptions",{smsAction:{name:"send_sms",label:"SMS",index:9,icon:{icon:"ic_smartphone_24px",iconSet:"hardware",type:"svg"}},smsCarriers:{ATT:"txt.att.net","T-Mobile":"tmomail.net",Virgin:"vmobl.com",Sprint:"messaging.sprintpcs.com",Nextel:"messaging.nextel.com",Verizon:"vtext.com",Cricket:"mms.mycricket.com",Qwest:"qwestmp.com","Project Fi":"msg.fi.google.com"}});